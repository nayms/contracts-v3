#!/usr/bin/env node
const path = require("path");
const fs = require("fs");
const chalk = require("chalk");

const PROJECT_DIR = path.join(__dirname, "..");
const CONST_SRC_FILE = path.join(
  PROJECT_DIR,
  "src",
  "diamonds",
  "nayms",
  "libs",
  "LibConstants.sol"
);

const GENERATED_CONSTANTS_SOL = path.join(
  PROJECT_DIR,
  "src",
  "diamonds",
  "nayms",
  "Constants.sol"
);

const src = fs
  .readFileSync(CONST_SRC_FILE)
  .toString("utf-8")
  .split("\n")
  .filter((l) => l.includes("internal constant"))
  .map((l) => l.replace("internal", "public"));

// write constants solidity file
fs.writeFileSync(
  GENERATED_CONSTANTS_SOL,
  `// SPDX-License-Identifier: MIT
pragma solidity >=0.8.13;

/// ------------------------------------------------------------------------------------------------------------
///
/// NOTE: this file is auto-generated by ${path.basename(
    __filename
  )}, please DO NOT modify it directly.
///
/// ------------------------------------------------------------------------------------------------------------

contract Constants {
${src.join("\n")}
}
`,
  { encoding: "utf-8" }
);

console.log(chalk.blue("== Constants =="));
console.log("Updated: ", GENERATED_CONSTANTS_SOL);
